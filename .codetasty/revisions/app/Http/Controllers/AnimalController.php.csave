codetasty.revision.2.0
{"ts":1501744683,"restoring":false,"user_id":4164,"patch":[{"diffs":[[1,"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\nuse App\\Models\\Object;\r\nuse App\\Models\\AnimalType;\r\nuse App\\Models\\BasicDocument;\r\nuse App\\Models\\Animal;\r\nuse App\\Http\\Requests\\StoreAnimal;\r\n\r\nclass AnimalController extends Controller\r\n{\r\n    public function index(Object $object)\r\n    {\r\n        $animal_groups = $object->animals()->with('animalType')->where('count','>', '1')->orderBy('name')->paginate(50);\r\n        $animal_individuals = $object->animals()->with('animalType')->where('count','<=', '1')->orderBy('name')->paginate(50);\r\n        return view('animals.index',\r\n            compact(['animals','object'])\r\n        );\r\n    }\r\n\r\n    public function create(Object $object)\r\n    {\r\n        $animalTypes = AnimalType::orderBy('name')->get()->pluck('name', 'id');\r\n        return view('animals.create',\r\n            compact(['animalTypes', 'object'])\r\n        );\r\n    }\r\n\r\n    public function store(Object $object, StoreAnimal $request)\r\n    {\r\n        //array_filter setting empty field to null\r\n        $data = array_filter($request->all(), 'strlen');\r\n        $animal = Animal::create($data);\r\n        $request->session()->flash('alert-success', 'Запись успешно добавлена!');\r\n        return redirect()->route('object.animal.index', $object);\r\n    }\r\n\r\n    public function edit(Object $object, Animal $animal)\r\n    {\r\n        $animalTypes = AnimalType::orderBy('name')->get()->pluck('name', 'id');\r\n        return view('animals.edit',\r\n            compact(['animalTypes', 'object', 'animal'])\r\n        );\r\n    }\r\n\r\n    public function update(Object $object, Animal $animal, StoreAnimal $request)\r\n    {\r\n        //array_filter setting empty field to null\r\n        $data = array_filter($request->all(), 'strlen');\r\n        $animal->fill($data)->save();\r\n        $request->session()->flash('alert-success', 'Запись успешно обновлена!');\r\n        return redirect()->route('object.animal.index', $object);\r\n    }\r\n\r\n    public function destroy(Request $request, Animal $animal)\r\n    {\r\n        $animal->delete();\r\n        $request->session()->flash('alert-success', 'Запись успешно удалена!');\r\n        return redirect()->route('fact.index');\r\n    }\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":2155}],"length":2155}
{"ts":1501744689,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ame')->paginate("],[-1,"50"],[1,"1"],[0,");\r\n        $ani"]],"start1":383,"start2":383,"length1":34,"length2":33},{"diffs":[[0,"ate("],[-1,"50"],[1,"1"],[0,");\r\n"]],"start1":522,"start2":522,"length1":10,"length2":9}],"length":2153}
{"ts":1501744704,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"['animal"],[1,"_groups','animal_individual"],[0,"s','obje"]],"start1":589,"start2":589,"length1":16,"length2":43}],"length":2180}
{"ts":1501744822,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"me')->paginate(1"],[1,", ['*'], 'groups_page'"],[0,");\r\n        $ani"]],"start1":384,"start2":384,"length1":32,"length2":54},{"diffs":[[0,"ginate(1"],[1,", ['*'], 'individuals_page'"],[0,");\r\n    "]],"start1":541,"start2":541,"length1":16,"length2":43}],"length":2229}
{"ts":1501744943,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ame')->paginate("],[-1,"1"],[1,"50"],[0,", ['*'], 'groups"]],"start1":383,"start2":383,"length1":33,"length2":34},{"diffs":[[0,"aginate("],[-1,"1"],[1,"50"],[0,", ['*'],"]],"start1":541,"start2":541,"length1":17,"length2":18}],"length":2231}
{"ts":1501745084,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ame')->paginate("],[-1,"50"],[1,"1"],[0,", ['*'], 'groups"]],"start1":383,"start2":383,"length1":34,"length2":33},{"diffs":[[0,"ate("],[-1,"50"],[1,"1"],[0,", ['"]],"start1":544,"start2":544,"length1":10,"length2":9}],"length":2229}
{"ts":1501749834,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ame')->paginate("],[-1,"1"],[1,"20"],[0,", ['*'], 'groups"]],"start1":383,"start2":383,"length1":33,"length2":34},{"diffs":[[0,"aginate("],[-1,"1"],[1,"20"],[0,", ['*'],"]],"start1":541,"start2":541,"length1":17,"length2":18}],"length":2231}