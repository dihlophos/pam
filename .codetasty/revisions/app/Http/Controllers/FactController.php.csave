codetasty.revision.2.0
{"ts":1501503566,"restoring":false,"user_id":4164,"patch":[{"diffs":[[1,"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Http\\Request;\r\nuse App\\Models\\Fact;\r\nuse App\\Models\\Prevention;\r\nuse App\\Models\\DiagnosticTest;\r\nuse App\\Models\\Object;\r\nuse App\\Models\\BasicDocument;\r\nuse App\\Models\\Animal;\r\nuse App\\Models\\Service;\r\nuse App\\Models\\Executor;\r\nuse App\\Models\\PreparationReceipt;\r\nuse App\\Models\\ResearchType;\r\nuse App\\Http\\Requests\\StoreFact;\r\n\r\nclass FactController extends Controller\r\n{\r\n    /**\r\n    * Display a listing of the resource.\r\n    *\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function index(Object $object)\r\n    {\r\n        $facts = $object->facts()->with('service')->orderBy('date', 'DESC')->paginate(50);\r\n\r\n        return view('facts.index', compact(['facts', 'object']));\r\n    }\r\n\r\n    /**\r\n    * Show the form for creating a new resource.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function create(Object $object)\r\n    {\r\n        $basic_documents = BasicDocument::orderBy('name')->get()->pluck('name', 'id');\r\n        $animals = $object->animals()->with('animalType')->get();\r\n        dd($animals);\r\n        $services = Service::orderBy('name')->get();\r\n        $executors = Executor::orderBy('name')->get()->pluck('name', 'id');\r\n        $research_types = ResearchType::orderBy('name')->get()->pluck('name', 'id');\r\n        $preparation_receipts = $object->subdivision->preparation_receipts()->with('preparation')->get();\r\n        return view('facts.create',\r\n            compact(['object', 'basic_documents', 'animals', 'services', 'executors', 'preparation_receipts', 'research_types'])\r\n        );\r\n    }\r\n\r\n    /**\r\n    * Store a newly created resource in storage.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function store(Object $object, StoreFact $request)\r\n    {\r\n        //array_filter setting empty field to null; for strings only\r\n        //$data = array_filter($request->all(), 'strlen');\r\n        $data = $request->all();\r\n        //TODO:\r\n        $fact = Fact::create($data);\r\n        if (isset($data['diseases']))\r\n        {\r\n            $fact->diseases()->attach($data['diseases']);\r\n        }\r\n        $data['fact_id'] = $fact->id;\r\n        switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n                $prevention = Prevention::create($data);\r\n                break;\r\n            case 2:\r\n                $diagnostic_test = DiagnosticTest::create($data);\r\n                break;\r\n            case 3:\r\n                break;\r\n        }\r\n        $request->session()->flash('alert-success', 'Запись успешно добавлена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n\r\n    /**\r\n    * Display the specified resource.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function show($id)\r\n    {\r\n        //\r\n    }\r\n\r\n    /**\r\n    * Show the form for editing the specified resource.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function edit(Object $object, Fact $fact)\r\n    {\r\n        //TODO:\r\n        return view('facts.edit',\r\n            compact(['fact', 'municipalities', 'cities'])\r\n        );\r\n    }\r\n\r\n    /**\r\n    * Update the specified resource in storage.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function update(Object $object, StoreFact $request, Fact $fact)\r\n    {\r\n        //array_filter setting empty field to null; for strings only\r\n        //$data = array_filter($request->all(), 'strlen');\r\n        $data = $request->all();\r\n        $fact->fill($data)->save();\r\n        $request->session()->flash('alert-success', 'Запись успешно обновлена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n\r\n    /**\r\n    * Remove the specified resource from storage.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function destroy(Object $object, Request $request, Fact $fact)\r\n    {\r\n        $fact->delete();\r\n        $request->session()->flash('alert-success', 'Запись успешно удалена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4320}],"length":4320}
{"ts":1501503626,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($animals);\r\n"],[0,"    "]],"start1":1126,"start2":1126,"length1":31,"length2":8}],"length":4297}
{"ts":1501650658,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"equest->all();\r\n"],[1,"        dd($data);\r\n"],[0,"        //TODO:\r"]],"start1":2025,"start2":2025,"length1":32,"length2":52}],"length":4317}
{"ts":1501651540,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($data);\r\n"],[0,"    "]],"start1":2037,"start2":2037,"length1":28,"length2":8}],"length":4297}
{"ts":1501655181,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"e(50);\r\n"],[1,"        dd($facts);"],[0,"\r\n      "]],"start1":673,"start2":673,"length1":16,"length2":35}],"length":4316}
{"ts":1501655246,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"    "],[-1,"dd($facts);"],[0,"\r\n  "]],"start1":685,"start2":685,"length1":19,"length2":8}],"length":4305}
{"ts":1501655325,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,")->with("],[1,"["],[0,"'service"]],"start1":621,"start2":621,"length1":16,"length2":17},{"diffs":[[0,"service'"],[1,",'animal']"],[0,")->order"]],"start1":631,"start2":631,"length1":16,"length2":26}],"length":4316}
{"ts":1501655335,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"        "],[1,"dd($facts);"],[0,"\r\n      "]],"start1":692,"start2":692,"length1":16,"length2":27}],"length":4327}
{"ts":1501655371,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($facts);"],[0,"\r\n  "]],"start1":688,"start2":688,"length1":27,"length2":8}],"length":4308}
{"ts":1501655494,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"'animal'"],[1,", 'animalType'"],[0,"])->orde"]],"start1":640,"start2":640,"length1":16,"length2":30}],"length":4322}
{"ts":1501655569,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ervice',"],[1," "],[0,"'animal'"]],"start1":632,"start2":632,"length1":16,"length2":17}],"length":4323}
{"ts":1501655649,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0," 'animal', '"],[1,"animal."],[0,"animalType']"]],"start1":640,"start2":640,"length1":24,"length2":31}],"length":4330}
{"ts":1501655709,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"e(50);\r\n"],[1,"        dd($facts);"],[0,"\r\n      "]],"start1":706,"start2":706,"length1":16,"length2":35}],"length":4349}
{"ts":1501655728,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($facts);\r\n"],[0,"    "]],"start1":710,"start2":710,"length1":29,"length2":8}],"length":4328}
{"ts":1501655898,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"rderBy('"],[1,"i"],[0,"d"],[-1,"ate"],[0,"', 'DESC"]],"start1":675,"start2":675,"length1":20,"length2":18}],"length":4326}
{"ts":1501655912,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"rderBy('"],[-1,"i"],[1,"create"],[0,"d', 'DES"]],"start1":675,"start2":675,"length1":17,"length2":22}],"length":4331}
{"ts":1501655920,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"'created"],[1,"_at"],[0,"', 'DESC"]],"start1":682,"start2":682,"length1":16,"length2":19}],"length":4334}
{"ts":1501658079,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"\n    {\r\n        "],[-1,"//TODO:"],[1,"switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n                //$prevention = Prevention::create($data);\r\n                break;\r\n            case 2:\r\n                //$diagnostic_test = DiagnosticTest::create($data);\r\n                break;\r\n            case 3:\r\n                break;\r\n        }"],[0,"\r\n        return"]],"start1":3161,"start2":3161,"length1":39,"length2":352}],"length":4647}
{"ts":1501658806,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"act'"],[-1,", 'municipalities', 'cities'"],[0,"])\r\n"]],"start1":3557,"start2":3557,"length1":36,"length2":8}],"length":4619}
{"ts":1501658894,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"    "],[-1,"switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n                //$prevention = Prevention::create($data);\r\n                break;\r\n            case 2:\r\n                //$diagnostic_t"],[1,"$basic_documents = BasicDocument::orderBy('name')->get()->pluck('name', 'id');\r\n        $animals = $object->animals()->with('animalType')->get();\r\n        $services = Service::orderBy('name')->get();\r\n        $executors = Executor::orderBy('name')->get()->pluck('name', 'id');\r\n        $research_typ"],[0,"es"],[-1,"t"],[0," = "],[-1,"DiagnosticTest::create($data);\r\n                break;\r\n            case 3:\r\n                break;\r\n        }\r\n        return view('facts.edit',\r\n            compact(['fact"],[1,"ResearchType::orderBy('name')->get()->pluck('name', 'id');\r\n        $preparation_receipts = $object->subdivision->preparation_receipts()->with('preparation')->get();\r\n        return view('facts.edit',\r\n            compact(['fact', 'object', 'basic_documents', 'animals', 'services', 'executors', 'preparation_receipts', 'research_types"],[0,"'])\r"]],"start1":3173,"start2":3173,"length1":391,"length2":647}],"length":4875}
{"ts":1501672658,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"tion')->get();\r\n"],[1,"        dd($fact->diagnostic_test);\r\n"],[0,"        return v"]],"start1":3632,"start2":3632,"length1":32,"length2":69}],"length":4912}
{"ts":1501672717,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($fact->diagnostic_test);\r\n"],[0,"    "]],"start1":3644,"start2":3644,"length1":45,"length2":8}],"length":4875}
{"ts":1501676860,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"equest->all();\r\n"],[1,"        dd($data);\r\n"],[0,"        //TODO:\r"]],"start1":2062,"start2":2062,"length1":32,"length2":52}],"length":4895}
{"ts":1501676909,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($data);\r\n"],[0,"    "]],"start1":2074,"start2":2074,"length1":28,"length2":8}],"length":4875}
{"ts":1501739664,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"'id');\r\n        "],[1,"//"],[0,"$preparation_rec"]],"start1":3533,"start2":3533,"length1":32,"length2":34}],"length":4877}
{"ts":1501739669,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n        "],[1,"//"],[0,"$preparation"]],"start1":1380,"start2":1380,"length1":24,"length2":26}],"length":4879}
{"ts":1501740067,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        //$preparation_receipts = $object->subdivision->preparation_receipts()->with('preparation')->get();\r\n"],[0,"    "]],"start1":1380,"start2":1380,"length1":117,"length2":8},{"diffs":[[0,"rs',"],[-1," 'preparation_receipts',"],[0," 're"]],"start1":1502,"start2":1502,"length1":32,"length2":8}],"length":4746}
{"ts":1501740399,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"tion')->get();\r\n"],[1,"        $preparation_receipts = $fact->>preparation_receipts()->with('preparation')->only(['id','preparation.name'])->get();\r\n        dd($preparation_receipts);\r\n"],[0,"        return v"]],"start1":3503,"start2":3503,"length1":32,"length2":194}],"length":4908}
{"ts":1501740414,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0," $fact->"],[-1,">"],[0,"preparat"]],"start1":3550,"start2":3550,"length1":17,"length2":16}],"length":4907}
{"ts":1501740425,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"paration_receipt"],[-1,"s"],[0,"()->with('prepar"]],"start1":3561,"start2":3561,"length1":33,"length2":32}],"length":4906}
{"ts":1501740661,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"tion')->get();\r\n"],[1,"         switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n        "],[0,"        $prepara"]],"start1":3503,"start2":3503,"length1":32,"length2":117},{"diffs":[[0," $fact->"],[1,"prevention->"],[0,"preparat"]],"start1":3635,"start2":3635,"length1":16,"length2":28},{"diffs":[[0,"_receipt"],[-1,"()"],[0,"->with('"]],"start1":3666,"start2":3666,"length1":18,"length2":16},{"diffs":[[0,".name'])->get();"],[1,"\r\n                break;\r\n            case 2:\r\n                $preparation_receipts = $fact->diagnostic_test->preparation_receipt->with('preparation')->only(['id','preparation.name'])->get();\r\n                break;\r\n            case 3:\r\n                break;\r\n        }\r\n        "],[0,"\r\n        dd($pr"]],"start1":3720,"start2":3720,"length1":32,"length2":314}],"length":5283}
{"ts":1501740668,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"       case 3:\r\n"],[1,"                $preparation_receipts = []\r\n"],[0,"                "]],"start1":3959,"start2":3959,"length1":32,"length2":76}],"length":5327}
{"ts":1501740679,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"pts = []"],[1,";"],[0,"\r\n      "]],"start1":4009,"start2":4009,"length1":16,"length2":17}],"length":5328}
{"ts":1501740751,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"')->"],[-1,"only(['id','preparation.name'])->"],[0,"get("]],"start1":3693,"start2":3693,"length1":41,"length2":8},{"diffs":[[0,"')->"],[-1,"only(['id','preparation.name'])->"],[0,"get("]],"start1":3852,"start2":3852,"length1":41,"length2":8}],"length":5262}
{"ts":1501740903,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"_receipts = "],[1,"//"],[0,"$fact->preve"]],"start1":3624,"start2":3624,"length1":24,"length2":26},{"diffs":[[0,"tion')->get();\r\n"],[1,"                                PreparationReceipt::select(DB::raw('*, preparation_receipts.id as id'))\r\n                                                  ->join('preparations', 'preparation_receipts.preparation_id', '=', 'preparations.id')\r\n                                                  ->wherePreparationReceiptId$fact->prevention->preparation_receipt->id);\r\n"],[0,"                "]],"start1":3691,"start2":3691,"length1":32,"length2":397}],"length":5629}
{"ts":1501740913,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"eceiptId"],[1,"("],[0,"$fact->p"]],"start1":4018,"start2":4018,"length1":16,"length2":17}],"length":5630}
{"ts":1501740935,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"p\\Request;\r\n"],[1,"use Illuminate\\Support\\Facades\\DB;\r\n"],[0,"use App\\Mode"]],"start1":62,"start2":62,"length1":24,"length2":60}],"length":5666}
{"ts":1501740946,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ipt->id)"],[1,"->get(0)"],[0,";\r\n     "]],"start1":4098,"start2":4098,"length1":16,"length2":24}],"length":5674}
{"ts":1501740948,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"d)->get("],[-1,"0"],[0,");\r\n    "]],"start1":4104,"start2":4104,"length1":17,"length2":16}],"length":5673}
{"ts":1501740962,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0," ->where"],[-1,"PreparationReceipt"],[0,"Id($fact"]],"start1":4034,"start2":4034,"length1":34,"length2":16}],"length":5655}
{"ts":1501741054,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"here"],[-1,"Id("],[1,"('preparation_receipts.id', "],[0,"$fac"]],"start1":4038,"start2":4038,"length1":11,"length2":36}],"length":5680}
{"ts":1501741116,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"s = "],[-1,"//$fact->prevention->preparation_receipt->with('preparation')->get();"],[0,"\r\n  "]],"start1":3668,"start2":3668,"length1":77,"length2":8},{"diffs":[[0,"s = "],[-1,"$fact->diagnostic_test->preparation_receipt->with('preparation'"],[1,"\r\n                                PreparationReceipt::select(DB::raw('*, preparation_receipts.id as id'))\r\n                                                  ->join('preparations', 'preparation_receipts.preparation_id', '=', 'preparations.id')\r\n                                                  ->where('preparation_receipts.id', $fact->diagnostic_test->preparation_receipt->id"],[0,")->g"]],"start1":4135,"start2":4135,"length1":71,"length2":384}],"length":5924}
{"ts":1501741127,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"  \r\n"],[-1,"        dd($preparation_receipts);\r\n"],[0,"    "]],"start1":4657,"start2":4657,"length1":44,"length2":8}],"length":5888}
{"ts":1501742279,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"        "],[-1,"//"],[0,"$prepara"]],"start1":3446,"start2":3446,"length1":18,"length2":16},{"diffs":[[0,"s = "],[-1,"$object->subdivision->preparation_receipts()->with('preparation')->get()"],[1,"[]"],[0,";\r\n "]],"start1":3474,"start2":3474,"length1":80,"length2":10},{"diffs":[[0,"3:\r\n"],[-1,"                $preparation_receipts = [];\r\n"],[0,"    "]],"start1":4495,"start2":4495,"length1":53,"length2":8}],"length":5771}
{"ts":1501742434,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,")->save();\r\n"],[1,"        if (isset($data['diseases']))\r\n        {\r\n            $fact->diseases()->sync($data['diseases']);\r\n        }\r\n        $data['fact_id'] = $fact->id;\r\n        switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n                $fact->prevention->fill($data)->save();\r\n                break;\r\n            case 2:\r\n                $fact->diagnostic_test->fill($data)->save();\r\n                break;\r\n            case 3:\r\n                break;\r\n        }\r\n"],[0,"        $req"]],"start1":5198,"start2":5198,"length1":24,"length2":501}],"length":6248}