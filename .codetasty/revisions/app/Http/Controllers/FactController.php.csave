codetasty.revision.2.0
{"ts":1501503566,"restoring":false,"user_id":4164,"patch":[{"diffs":[[1,"<?php\r\n\r\nnamespace App\\Http\\Controllers;\r\n\r\nuse Illuminate\\Http\\Request;\r\nuse App\\Models\\Fact;\r\nuse App\\Models\\Prevention;\r\nuse App\\Models\\DiagnosticTest;\r\nuse App\\Models\\Object;\r\nuse App\\Models\\BasicDocument;\r\nuse App\\Models\\Animal;\r\nuse App\\Models\\Service;\r\nuse App\\Models\\Executor;\r\nuse App\\Models\\PreparationReceipt;\r\nuse App\\Models\\ResearchType;\r\nuse App\\Http\\Requests\\StoreFact;\r\n\r\nclass FactController extends Controller\r\n{\r\n    /**\r\n    * Display a listing of the resource.\r\n    *\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function index(Object $object)\r\n    {\r\n        $facts = $object->facts()->with('service')->orderBy('date', 'DESC')->paginate(50);\r\n\r\n        return view('facts.index', compact(['facts', 'object']));\r\n    }\r\n\r\n    /**\r\n    * Show the form for creating a new resource.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function create(Object $object)\r\n    {\r\n        $basic_documents = BasicDocument::orderBy('name')->get()->pluck('name', 'id');\r\n        $animals = $object->animals()->with('animalType')->get();\r\n        dd($animals);\r\n        $services = Service::orderBy('name')->get();\r\n        $executors = Executor::orderBy('name')->get()->pluck('name', 'id');\r\n        $research_types = ResearchType::orderBy('name')->get()->pluck('name', 'id');\r\n        $preparation_receipts = $object->subdivision->preparation_receipts()->with('preparation')->get();\r\n        return view('facts.create',\r\n            compact(['object', 'basic_documents', 'animals', 'services', 'executors', 'preparation_receipts', 'research_types'])\r\n        );\r\n    }\r\n\r\n    /**\r\n    * Store a newly created resource in storage.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function store(Object $object, StoreFact $request)\r\n    {\r\n        //array_filter setting empty field to null; for strings only\r\n        //$data = array_filter($request->all(), 'strlen');\r\n        $data = $request->all();\r\n        //TODO:\r\n        $fact = Fact::create($data);\r\n        if (isset($data['diseases']))\r\n        {\r\n            $fact->diseases()->attach($data['diseases']);\r\n        }\r\n        $data['fact_id'] = $fact->id;\r\n        switch ($fact->service->tab_index)\r\n        {\r\n            case 1:\r\n                $prevention = Prevention::create($data);\r\n                break;\r\n            case 2:\r\n                $diagnostic_test = DiagnosticTest::create($data);\r\n                break;\r\n            case 3:\r\n                break;\r\n        }\r\n        $request->session()->flash('alert-success', 'Запись успешно добавлена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n\r\n    /**\r\n    * Display the specified resource.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function show($id)\r\n    {\r\n        //\r\n    }\r\n\r\n    /**\r\n    * Show the form for editing the specified resource.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function edit(Object $object, Fact $fact)\r\n    {\r\n        //TODO:\r\n        return view('facts.edit',\r\n            compact(['fact', 'municipalities', 'cities'])\r\n        );\r\n    }\r\n\r\n    /**\r\n    * Update the specified resource in storage.\r\n    *\r\n    * @param  \\Illuminate\\Http\\Request  $request\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function update(Object $object, StoreFact $request, Fact $fact)\r\n    {\r\n        //array_filter setting empty field to null; for strings only\r\n        //$data = array_filter($request->all(), 'strlen');\r\n        $data = $request->all();\r\n        $fact->fill($data)->save();\r\n        $request->session()->flash('alert-success', 'Запись успешно обновлена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n\r\n    /**\r\n    * Remove the specified resource from storage.\r\n    *\r\n    * @param  int  $id\r\n    * @return \\Illuminate\\Http\\Response\r\n    */\r\n    public function destroy(Object $object, Request $request, Fact $fact)\r\n    {\r\n        $fact->delete();\r\n        $request->session()->flash('alert-success', 'Запись успешно удалена!');\r\n        return redirect()->route('object.fact.index', $object);\r\n    }\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4320}],"length":4320}
{"ts":1501503626,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($animals);\r\n"],[0,"    "]],"start1":1126,"start2":1126,"length1":31,"length2":8}],"length":4297}
{"ts":1501650658,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"equest->all();\r\n"],[1,"        dd($data);\r\n"],[0,"        //TODO:\r"]],"start1":2025,"start2":2025,"length1":32,"length2":52}],"length":4317}
{"ts":1501651540,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($data);\r\n"],[0,"    "]],"start1":2037,"start2":2037,"length1":28,"length2":8}],"length":4297}
{"ts":1501655181,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"e(50);\r\n"],[1,"        dd($facts);"],[0,"\r\n      "]],"start1":673,"start2":673,"length1":16,"length2":35}],"length":4316}
{"ts":1501655246,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"    "],[-1,"dd($facts);"],[0,"\r\n  "]],"start1":685,"start2":685,"length1":19,"length2":8}],"length":4305}
{"ts":1501655325,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,")->with("],[1,"["],[0,"'service"]],"start1":621,"start2":621,"length1":16,"length2":17},{"diffs":[[0,"service'"],[1,",'animal']"],[0,")->order"]],"start1":631,"start2":631,"length1":16,"length2":26}],"length":4316}
{"ts":1501655335,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"        "],[1,"dd($facts);"],[0,"\r\n      "]],"start1":692,"start2":692,"length1":16,"length2":27}],"length":4327}
{"ts":1501655371,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($facts);"],[0,"\r\n  "]],"start1":688,"start2":688,"length1":27,"length2":8}],"length":4308}
{"ts":1501655494,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"'animal'"],[1,", 'animalType'"],[0,"])->orde"]],"start1":640,"start2":640,"length1":16,"length2":30}],"length":4322}
{"ts":1501655569,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"ervice',"],[1," "],[0,"'animal'"]],"start1":632,"start2":632,"length1":16,"length2":17}],"length":4323}
{"ts":1501655649,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0," 'animal', '"],[1,"animal."],[0,"animalType']"]],"start1":640,"start2":640,"length1":24,"length2":31}],"length":4330}
{"ts":1501655709,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"e(50);\r\n"],[1,"        dd($facts);"],[0,"\r\n      "]],"start1":706,"start2":706,"length1":16,"length2":35}],"length":4349}
{"ts":1501655728,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,");\r\n"],[-1,"        dd($facts);\r\n"],[0,"    "]],"start1":710,"start2":710,"length1":29,"length2":8}],"length":4328}
{"ts":1501655898,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"rderBy('"],[1,"i"],[0,"d"],[-1,"ate"],[0,"', 'DESC"]],"start1":675,"start2":675,"length1":20,"length2":18}],"length":4326}
{"ts":1501655912,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"rderBy('"],[-1,"i"],[1,"create"],[0,"d', 'DES"]],"start1":675,"start2":675,"length1":17,"length2":22}],"length":4331}
{"ts":1501655920,"restoring":false,"user_id":4164,"patch":[{"diffs":[[0,"'created"],[1,"_at"],[0,"', 'DESC"]],"start1":682,"start2":682,"length1":16,"length2":19}],"length":4334}